"use strict";angular.module("ubirchAdminCrudApp",["ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","xeditable","pascalprecht.translate","ui.router","ui-leaflet","ui.bootstrap","datetimepicker","angularUUID2","angularMoment","toaster","ngStorage","angularSpinner","ubirchAuth"]).config(["$stateProvider","$urlRouterProvider","$translateProvider","$locationProvider","$httpProvider",function(a,b,c,d,e){c.useStaticFilesLoader({files:[{prefix:"i18n/",suffix:".json"}]}).registerAvailableLanguageKeys(["en","de"],{"en_*":"en","de_*":"de","*":"en"}).determinePreferredLanguage().useSanitizeValueStrategy("escape"),a.state("auth",{url:"/auth",templateUrl:"../views/auth.html",controller:"AuthCtrl",controllerAs:"auth"}).state("check-activation",{url:"/check-activation",templateUrl:"../views/check-activation.html",controller:"CheckActivationCtrl",controllerAs:"checkActivation"}).state("login",{url:"/login",templateUrl:"../views/login.html",controller:"LoginCtrl",controllerAs:"login"}).state("register",{url:"/register",templateUrl:"../views/register.html",controller:"RegisterCtrl",controllerAs:"register"}).state("not-activated",{url:"/not-activated",templateUrl:"../views/not-activated.html",controller:"notActivatedCtrl",controllerAs:"notActivated",tokenRequired:!0}).state("device-details",{url:"/device-details/:deviceid",templateUrl:"../views/device-details.html",controller:"DeviceDetailsCtrl",controllerAs:"deviceDetails",tokenRequired:!0,resolve:{deviceTypesList:["DeviceTypes",function(a){return a.getDeviceTypeList()}]}}).state("devices-list",{url:"/devices-list",templateUrl:"../views/devices-list.html",controller:"DevicesListCtrl",controllerAs:"devicesList",tokenRequired:!0,resolve:{deviceTypesList:["DeviceTypes",function(a){return a.getDeviceTypeList()}]}}).state("devices-map",{url:"/devices-map",templateUrl:"../views/devices-map.html",controller:"DevicesMapCtrl",controllerAs:"devicesMap",tokenRequired:!0,resolve:{deviceTypesList:["DeviceTypes",function(a){return a.getDeviceTypeList()}]}}),b.otherwise("devices-list"),e.interceptors.push("OAuth2Interceptor")}]).run(["$rootScope","$location","AuthService","UserService","constants","toaster",function(a,b,c,d,e,f){if(void 0===e.TODAY){var g=new Date;e.TODAY=new Date(g.getFullYear(),g.getMonth(),g.getDate()),e.ONEDAY=864e5,e.TOMORROW=e.TODAY.getTime()+e.ONEDAY,e.TODAY_END=e.TOMORROW-1}angular.extend(a,{center:{},markers:{}}),a.$on("$stateChangeStart",function(a,e){e.tokenRequired&&(c.authenticationRequired()?b.path("/auth"):d.activationCheckRequired()?b.path("/check-activation"):d.getActivationFlag()===!1&&b.path("/not-activated"))}),a.closeModal=function(a){angular.element(a).modal("hide"),angular.element("body").removeClass("modal-open"),angular.element(".modal-backdrop").remove()},a.showError=function(a){a.data&&a.data.errorMessage&&f.pop("error",a.data&&a.data.errorType?a.data.errorType:"Fehler",a.data&&a.data.errorMessage?a.data.errorMessage:"Es konnte kein neues Gerät angelegt werden!!")}}]).config(["$qProvider",function(a){a.errorOnUnhandledRejections(!1)}]),angular.module("ubirchAdminCrudApp").directive("navigation",function(){return{templateUrl:"views/directives/navigation.html",restrict:"E",controllerAs:"navCtrl",controller:["$scope","$rootScope","$location","AuthService","UserService",function(a,b,c,d,e){b.signedIn=!d.authenticationRequired(),a.account={value:void 0},b.$watch("signedIn",function(b){b?e.getAccount().$promise.then(function(b){a.account.value=b,a.account.activated=b.activeUser===!0?!0:!1}):(a.account.value=void 0,a.account.activated=void 0)}),a.navClass=function(a){var b=c.path().substring(1)||"devices-list";return 0===b.indexOf("device-details")&&(b="devices-list"),a===b?"active":""},a.loadDeviceslist=function(){c.url("/devices-list")},a.loadDevicesMap=function(){c.url("/devices-map")},a.loadAbout=function(){c.url("/about")}}]}}),angular.module("ubirchAdminCrudApp").controller("DeviceDetailsCtrl",["$scope","$rootScope","$window","$location","$sessionStorage","constants","settings","$stateParams","$filter","$timeout","Device","toaster","deviceTypesList","DeviceTypes","NACL","leafletBoundsHelpers",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(b){k.getDevice(b,function(b){a.device=b,a.deviceType=i("getDeviceType")(m,b.deviceTypeKey),a.getKeysList(a.device.hwDeviceId),a.devInfo.query={docuUrl:f.AVATAR_SERVICE_DOCUMENTATION,example:{deviceId:a.device.deviceId,token:e.token.token,host:g.UBIRCH_API_HOST,curl:"curl -XGET -H 'Authorization: Bearer $TOKEN' $HOST/api/avatarService/v1/device/$DEVICEID/data/history/0/10"}},void 0!==g.MQTT_SERVER&&(a.devInfo.mqtt.host=g.MQTT_SERVER.HOST,void 0!==g.MQTT_SERVER.PORT&&(a.devInfo.mqtt.port=g.MQTT_SERVER.PORT),a.devInfo.mqtt.serverUrl=g.MQTT_SERVER.HOST+(void 0!==g.MQTT_SERVER.PORT?":"+g.MQTT_SERVER.PORT:""),a.devInfo.mqtt.curl="mosquitto_sub -h "+a.devInfo.mqtt.host+(void 0!==a.devInfo.mqtt.port?" -p "+a.devInfo.mqtt.port:"")+' -t "'+g.ENV_ID+'/ubirch/devices/$DEVICEID/processed" -u $USER -P $PWD',a.devInfo.mqtt.topic=g.ENV_ID+"/ubirch/devices/$DEVICE_ID/processed")},function(a){$log.warn("On loading device details an error uccurred: "+a)})}function r(b){var c=Object.keys(b);if(c.length){var d=b[c[0]],e=[[d.lat,d.lng],[d.lat,d.lng]];c.forEach(function(a){d=b[a],d.lat<e[0][0]&&(e[0][0]=d.lat),d.lng<e[0][1]&&(e[0][1]=d.lng),d.lat>e[1][0]&&(e[1][0]=d.lat),d.lng>e[1][1]&&(e[1][1]=d.lng)}),a.leafletValues.bounds=p.createBoundsFromArray(e)}else a.leafletValues.bounds={}}function s(){var b={};a.messages.content&&a.messages.content.forEach(function(c,d){if(c.deviceMessage.location.lat&&c.deviceMessage.location.lon){var e={focus:!1,draggable:!1,lat:c.deviceMessage.location.lat,lng:c.deviceMessage.location.lon,message:u(c),opacity:1-1/a.messages.content.length*d};b["marker"+d]=angular.copy(e)}}),a.leafletValues.markers=b,Object.keys(b).length>0?(r(b),a.markersDefined=!0):a.markersDefined=!1}function t(a,b,c){return b.length>0&&(b+=", "),b+=c+": "+a.deviceMessage[c]}function u(a){var b=n.getDeviceTypeList(),c=i("getDeviceType")(b,a.deviceType),d=new Date(a.timestamp).getTime(),e="";Object.keys(a.deviceMessage).forEach(function(b){c&&c.displayKeys&&c.displayKeys.length>0?-1!==c.displayKeys.indexOf(b)&&(e=t(a,e,b)):"loction.lat"!=b&&"location.lon"!=b&&(e=t(a,e,b))});var f=c.name.en;return f+="<br><strong>",f+=e,f+="</strong>",f+="<br>"+i("date")(d,"yyyy-MM-dd, H:mm:ss")}var v="devices-list";a.deviceid=h.deviceid,a.activeTab="state",a.keyCreateAllowedTypes=g.KEY_GENERATION_FOR_DEVICE_TYPES,a.device={},a.loadDeviceState=!0,a.deviceState=[];var w=[];if(a.stateDataChanged=!1,a.stateKats=[],a.values={},a.values.numOfMessages=10,a.startIndex=0,a.endOfDataReached=!1,a.messages={content:void 0},a.activeTab={main:"history",visual:"chart",filter:"filterbyrange"},a.filterValues={startIndex:0,numOfMessages:10,startDate:void 0,endDate:void 0,ignoreTime:!1,autoreload:!1},a.shownSeries={},a.seperationParams={yaxes:"all"},a.leafletValues={center:{},markers:{},bounds:{},defaults:{scrollWheelZoom:!1}},a.markersDefined=!1,a.devInfo={mqtt:{},query:{}},a.getKeysList=function(c){o.getCurrentKeysOf(c,function(b){a.publicKeys=b},b.showError)},a.checkKeyPairCreationAllowed=function(){var b=void 0!==a.keyCreateAllowedTypes&&a.keyCreateAllowedTypes.indexOf(a.deviceType.key)>=0;return b},h.deviceid){q(h.deviceid);var x;!function y(){a.loadDeviceState&&k.getDeviceState(h.deviceid,function(b){var c={},d=[];angular.forEach(b,function(b,e){if(!e.startsWith("$"))if("object"!=typeof b)a[e]=b;else{var f=e;d.push(f),angular.forEach(b,function(a,b){c[b]||(c[b]={stateKey:b}),c[b][f]=a})}}),a.deviceState=c,a.stateKats=d,w=angular.copy(a.deviceState),void 0!==x&&j.cancel(x),x=j(y,f.POLLING_INTERVAL)},function(b){a.loadDeviceState=!1,$log.warn("No device state available; error uccurred: "+b)})}(),a.$on("$destroy",function(){void 0!==x&&j.cancel(x)}),a.$on("auth:signedOut",function(){void 0!==x&&j.cancel(x)})}a.checkDeviceStateChanges=function(){a.stateDataChanged=!0},a.discardDeviceStateChanges=function(){a.deviceState=angular.copy(w),a.stateDataChanged=!1},a.saveDeviceStateChanges=function(){w=angular.copy(a.deviceState),a.stateDataChanged=!1,l.pop("info","Sorry, changing the state of a device is not yet implemented!")},a.added=k.initDevice(),a.updateDevice=function(){a.device=k.addProperties(a.device,a.added),a.added=k.initDevice(),k.updateDevice(a.device,function(b){q(a.device.deviceId),l.pop("success","Änderungen gespeichert","Änderungen am Gerät wurden gespeichert")},function(){l.pop("error","Fehler","Gerät konnte nicht geändert werden!!")})},a.deleteDevice=function(){b.closeModal("#myModal"),k.deleteDevice(a.device.deviceId,function(){d.url("devices-list")},function(){l.pop("error","Fehler","Gerät konnte nicht gelöscht werden!!")})},a.backToList=function(){d.url(v)},a.selectType=function(b){a.device.deviceTypeKey=b},a.generateKeyPair=function(){var c=o.generateKeyPairAndStorePubKey(a.device.hwDeviceId,function(b){a.keys={base64:{"public":b.pubKeyInfo.pubKey},hex:{"public":o.formatHex(c.publicKey),secret:o.formatHex(c.secretKey)},ccp:{"public":o.formatCCP(c.publicKey),secret:o.formatCCP(c.secretKey)}},a.getKeysList(a.device.hwDeviceId)},b.showError)},a.$watch("messages.content",function(){s()})}]);var app=angular.module("ubirchAdminCrudApp");app.run(["editableOptions",function(a){a.theme="bs3"}]),app.controller("DevicesListCtrl",["$scope","$rootScope","$location","Device","$translate","$window","$document","$timeout","$filter","$log","toaster","DeviceTypes","constants","settings","deviceTypesList",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){a.deviceTypes=o;var p;!function q(){d.getDevicesList(function(b){a.devices=b,p=h(q,m.POLLING_INTERVAL)},function(a){j.warn("On loading device list an error uccurred: "+a),p=h(q,m.POLLING_INTERVAL)})}(),a.$on("$destroy",function(){h.cancel(p)}),a.$on("auth:signedOut",function(){h.cancel(p)}),a.fromToday=function(a){return new Date(a)>=m.TODAY},a.openDeviceDetails=function(a){c.url("device-details/"+a)},a.openNewDeviceDialog=function(){a.newDevice={deviceTypeKey:n.DEFAULT_DEVICE_TYPE_KEY?n.DEFAULT_DEVICE_TYPE_KEY:m.DEFAULT_DEVICE_TYPE_KEY},a.addedProperties=d.initDevice(),a.$watch("newDevice.deviceTypeKey",function(b){var c=i("getDeviceType")(a.deviceTypes,b);a.newDevice.deviceProperties=c.defaults.properties,a.newDevice.tags=c.defaults.tags,a.newDevice.deviceConfig=c.defaults.config}),angular.element("#myModal").modal("show")},a.cancelCreateDevice=function(){k.pop("warning","Abbruch","Anlegen eines neuen Gerätes wurde abgebrochen")},a.createDevice=function(){b.closeModal("#myModal"),a.newDevice=d.addProperties(a.newDevice,a.addedProperties),a.addedProperties=d.initDevice(),d.createDevice(a.newDevice,function(a){c.url("device-details/"+a.deviceId)},function(a){a.data&&a.data.errorMessage&&k.pop("error",a.data&&a.data.errorType?a.data.errorType:"Fehler",a.data&&a.data.errorMessage?a.data.errorMessage:"Es konnte kein neues Gerät angelegt werden!!")})},a.match=function(a){return function(b){return b.key.match(a)}}}]),angular.module("ubirchAdminCrudApp").service("Device",["$resource","constants","settings","$log","uuid2","moment",function(a,b,c,d,e,f){var g=c.UBIRCH_API_HOST+b.AVATAR_SERVICE_REST_ENDPOINT;return{device:a(g+"/device/:deviceId",{deviceId:"@deviceId"},{update:{method:"PUT",params:{deviceId:"@deviceId"},isArray:!1}}),deviceStub:a(g+"/device/stub/:deviceId",{deviceId:"@deviceId"}),getDevicesList:function(a){return this.deviceStub.query(function(b){d.debug("Got devices list data: "+b),void 0!==a&&a(b)},function(a){d.debug("Requested list of devices - ERROR OCCURRED: "+a)})},createDevice:function(a,b,c){var f=e.newuuid();return a.deviceId=f,this.device.save({},a,function(a){d.debug("Saved device with deviceId "+f+": "+a),void 0!==b&&b(a)},function(a){d.debug("Requested device data and config - ERROR OCCURRED: "+a),void 0!==c&&c(a)})},updateDevice:function(a,b,c){return this.device.update({deviceId:a.deviceId},a,function(a){d.debug("Successfully saved update of device: "+a),void 0!==b&&b(a)},function(a){d.debug("Tried to save update of device - ERROR OCCURRED: "+a),void 0!==c&&c(a)})},getDevice:function(a,b,c){return this.device.get({deviceId:a},function(a){d.debug("Got device data and config: "+a),void 0!==b&&b(a)},function(a){d.debug("Requested device data and config - ERROR OCCURRED: "+a),void 0!==c&&c(a)})},deleteDevice:function(a,b,c){return this.device["delete"]({deviceId:a},function(a){d.debug("Device deleted: "+a),void 0!==b&&b(a)},function(a){d.debug("Tried to delete device - ERROR OCCURRED: "+a),void 0!==c&&c(a)})},deviceState:a(g+"/device/:deviceId/state",{deviceId:"@deviceId"}),getDeviceState:function(a,b,c){return this.deviceState.get({deviceId:a},function(a){d.debug("Got device state: "+a),void 0!==b&&b(a)},function(a){void 0!==c?c(a):d.debug("Requested device state - ERROR OCCURRED: "+a)})},history:a(g+"/device/:deviceId/data/history",{deviceId:"@deviceId"}),history_of_data_range:a(g+"/device/:deviceId/data/history/:from/:size",{deviceId:"@deviceId",from:"@from",size:"@size"}),history_of_day:a(g+"/device/:deviceId/data/history/byDate/day/:date",{deviceId:"@deviceId",date:"@date"}),history_of_date_range:a(g+"/device/:deviceId/data/history/byDate/from/:from/to/:to",{deviceId:"@deviceId",from:"@from",to:"@to"}),getHistory:function(a){return this.history.query({deviceId:a},function(a){d.debug("Got history data from Device: "+a)},function(a){d.debug("Requested history from Device - ERROR OCCURRED: "+a)})},getHistoryOfRange:function(a,b,c,e,f){return this.history_of_data_range.query({deviceId:a,from:b,size:c},function(a){e&&e(a)},function(a){d.debug("Requested history from Device - ERROR OCCURRED: "+a),f&&f(a)})},getHistoryOfDateRange:function(a,b,c,e,g,h){if(!b||!c)return h("No date range defined"),null;var i=f(b,"llll"),j=f(c,"llll");if(i.isAfter(j)){var k=i;i=j,j=k,console.warn("From date is after to date; used in reverse order!")}return e&&(i.startOf("day"),j.endOf("day")),this.history_of_date_range.query({deviceId:a,from:i.toISOString(),to:j.toISOString()},function(a){g&&g(a)},function(a){d.debug("Requested history from Device - ERROR OCCURRED: "+a),h&&h(a)})},initDevice:function(){return{properties:[],config:[],tags:[]}},addProperties:function(a,b){var c=function(b,c){b.forEach(function(b){if(void 0===a[c]&&(a[c]={}),b.key.length>0&&b.value.length>0){var d=b.value;!isNaN(b.value)&&angular.isNumber(+b.value)?d=parseFloat(b.value):"TRUE"===b.value.toUpperCase()?d=!0:"FALSE"===b.value.toUpperCase()&&(d=!1),a[c][b.key]=d}})};return c(b.properties,"deviceProperties"),c(b.config,"deviceConfig"),b.tags.forEach(function(b){void 0===a.tags&&(a.tags=[]),b.value.length>0&&-1===a.tags.indexOf(b.value)&&a.tags.push(b.value)}),a}}}]),angular.module("ubirchAdminCrudApp").constant("constants",{CHAIN_SERVICE_REST_ENDPOINT:"/api/v1/chainService/explorer",AVATAR_SERVICE_REST_ENDPOINT:"/api/avatarService/v1",AVATAR_SERVICE_DOCUMENTATION:"http://developer.ubirch.com/docs/api/swagger-ui.html?url=https://raw.githubusercontent.com/ubirch/ubirchApiDocs/master/swaggerDocs//ubirch/avatar_service/1.0/ubirch_avatar_service_api.yaml",AUTH_SERVICE_REST_ENDPOINT:"/api/authService/v1",USER_SERVICE_REST_ENDPOINT:"/api/authService/v1",KEY_SERVICE_REST_ENDPOINT:"/api/keyService/v1",POLLING_INTERVAL:3e3,DEFAULT_DEVICE_TYPE_KEY:"unknownDeviceTypeKey",INTIAL_GROUP_NAME:"my-ubirch-group",TODAY:void 0,KEY_TIME_FORMAT:"YYYY-MM-DDTHH:mm:ss.SSS[Z]"}),angular.module("ubirchAdminCrudApp").controller("DevicesMapCtrl",["$scope","Device","deviceTypesList","constants","$timeout",function(a,b,c,d,e){function f(a){return b.getHistoryOfRange(a,0,10,function(a){return a.length>0?a:[]},function(){return[]})}a.deviceTypes=c,function(){b.getDevicesList(function(b){a.devices=b})}(),a.selected={devices:{}},a.switchDeviceSelection=function(b){return void 0===a.selected.devices[b.deviceId]?(b.messages=f(b.deviceId),a.selected.devices[b.deviceId]=b,a.lastAddedDevice=b,a.lastRemovedDevice=void 0):(delete a.selected.devices[b.deviceId],a.lastRemovedDevice=b,a.lastAddedDevice=void 0),void 0!==a.selected.devices[b.deviceId]},a.isSelected=function(b){return void 0!==a.selected.devices[b]},a.match=function(a){return function(b){return b.key.match(a)}};var g;a.$on("$destroy",function(){void 0!==g&&e.cancel(g)}),a.$on("auth:signedOut",function(){void 0!==g&&e.cancel(g)})}]),angular.module("ubirchAdminCrudApp").directive("truthworth",function(){return{template:'<i class="sensor-trustworth-icon {{colorClassStr}} ion-record"></i>',restrict:"E",replace:!0,scope:{device:"@"},link:function(a,b,c){a.colorClassStr="grey";var d=angular.fromJson(c.device);switch(d.deviceType){case"lightsSensor":a.colorClassStr="green";break;case"temperaturesSensor":a.colorClassStr="yellow";break;case"noisesSensor":a.colorClassStr="red";break;case"wetnessSensor":a.colorClassStr="yellow";break;default:a.colorClassStr="grey"}}}}),angular.module("ubirchAdminCrudApp").directive("syncstate",function(){return{templateUrl:"views/directives/syncstate.html",restrict:"E",replace:!0,scope:{inSync:"@"},link:function(a){var b=function(b){"true"===b?a.showInSync=!0:"false"===b?a.showInSync=!1:a.showInSync=void 0};b(a.inSync),a.$watch("inSync",function(a){b(a)})}}}),angular.module("ubirchAdminCrudApp").directive("timestamp",["constants",function(a){return{templateUrl:"views/directives/timestamp.html",restrict:"E",replace:!0,scope:{date:"@"},link:function(b){b.isToday=function(b){if(void 0===b)return!1;var c=new Date(b);return c>a.TODAY&&c<a.TOMORROW}}}}]),angular.module("ubirchAdminCrudApp").service("ChainService",["$resource","settings","constants",function(a,b,c){var d=b.UBIRCH_API_HOST+c.CHAIN_SERVICE_REST_ENDPOINT;return{eventHash:a(d+"/eventHash/:eventHash",{eventHash:"@eventHash"}),blockInfo:a(d+"/blockInfo/:blockHash",{blockHash:"@blockHash"}),fullBlock:a(d+"/fullBlock/:blockHash",{blockHash:"@blockHash"}),blockInfoByPrevious:a(d+"/blockInfoByPrevious/:blockHash",{blockHash:"@blockHash"})}}]),angular.module("ubirchAdminCrudApp").directive("blockchain",["ChainService","$log",function(a,b){return{template:'<i class="sensor-trustworth-icon {{colorClass}} {{icon}}">',restrict:"E",replace:!0,scope:{message:"@"},link:function(c,d,e){c.colorClass="grey",c.icon="ion-ios-bolt";var f="42e52035c9ab81c47fb48b627436011eae2f50e9dc6923dfa3a6f7647da6d587",g=angular.fromJson(e.message);g&&(g.hash&&(f=g.hash),a.eventHash.get({eventHash:f},function(a){b.debug("Got block info for event hash: "+a)}))}}}]),angular.module("ubirchAdminCrudApp").directive("messageheader",function(){return{templateUrl:"views/directives/messageheader.html",restrict:"E",scope:{message:"@",deviceType:"@"},link:function(a){a.messageObj=angular.fromJson(a.message),a.type=a.messageObj.deviceType,a.deviceMessage=a.messageObj.deviceMessage}}}),angular.module("ubirchAdminCrudApp").directive("messagecontent",function(){return{templateUrl:"views/directives/messagecontent.html",restrict:"E",scope:{message:"@"},link:function(a){a.messageObj=angular.fromJson(a.message),a.type=a.messageObj.deviceType,a.deviceMessage=a.messageObj.deviceMessage,a.messageKeys=Object.keys(a.deviceMessage)}}}),angular.module("ubirchAdminCrudApp").constant("settings",{CONTEXT:"ubirch-local",APP_ID:"admin-ui",UBIRCH_API_HOST:"http://localhost:8080",UBIRCH_AUTH_SERVICE_API_HOST:"http://localhost:8091",UBIRCH_USER_SERVICE_API_HOST:"http://localhost:8091",UBIRCH_KEY_SERVICE_API_HOST:"http://localhost:8095",DEFAULT_DEVICE_TYPE_KEY:"unknownDeviceType",DEFAULT_AUTH_EXPIRED_SECS:-1,MQTT_SERVER:{HOST:"localhost",PORT:"1883"},ENV_ID:"local-dev",KEY_GENERATION_FOR_DEVICE_TYPES:["calliopeMini"]}),angular.module("ubirchAdminCrudApp").directive("devicetypelist",["DeviceTypes","$filter",function(a,b){return{templateUrl:"views/directives/devicetypelist.html",restrict:"E",replace:!0,scope:{deviceTypeKey:"="},link:function(c){c.deviceTypes=a.getDeviceTypeList(),c.$watch("deviceTypeKey",function(a){c.selectedDeviceType=b("getDeviceType")(c.deviceTypes,a)}),c.selectType=function(a){c.deviceTypeKey=a.key}}}}]);var app=angular.module("ubirchAdminCrudApp");app.filter("getDeviceType",["settings","constants","$log",function(a,b,c){return function(d,e){if(void 0!==d&&d.length>0){if(void 0!==e)for(var f=0,g=d.length;g>f;f++)if(d[f].key===e)return d[f];if(void 0!==a.DEFAULT_DEVICE_TYPE_KEY)return d[a.DEFAULT_DEVICE_TYPE_KEY];if(void 0!==b.DEFAULT_DEVICE_TYPE_KEY)return d[b.DEFAULT_DEVICE_TYPE_KEY];c.warn("Missing default device type!! Please add default device type key in settings > DEFAULT_DEVICE_TYPE_KEY")}return null}}]),app.service("DeviceTypes",["$resource","constants","settings","$log",function(a,b,c,d){var e,f=c.UBIRCH_API_HOST+b.AVATAR_SERVICE_REST_ENDPOINT,g=a(f+"/device/deviceType");return g.getDeviceTypeList=function(){return void 0===e&&(e=g.query(function(){void 0===b.DEFAULT_DEVICE_TYPE_KEY&&d.warn("Missing default device type!! Please add default device type key in settings > DEFAULT_DEVICE_TYPE_KEY")})),e},g}]),angular.module("ubirchAdminCrudApp").directive("deviceEditableFields",function(){return{templateUrl:"views/directives/deviceeditablefields.html",restrict:"E",replace:!0,scope:{device:"=",addedProperties:"=",creationView:"@"},link:function(a){a.add=function(b){switch(b){case"property":a.addedProperties.properties.push({key:"",value:""});break;case"config":a.addedProperties.config.push({key:"",value:""});break;case"tag":a.addedProperties.tags.push({value:""})}},a.deleteField=function(b,c,d){switch(b){case"property":d?a.addedProperties.properties.splice(c,1):delete a.device.deviceProperties[c];break;case"config":d?a.addedProperties.config.splice(c,1):delete a.device.deviceConfig[c];break;case"tag":d?a.addedProperties.tags.splice(c,1):a.device.tags.splice(c,1)}},a.getTypeFor=function(a){if(void 0===a)return"string";switch(typeof a){case"number":case"boolean":case"string":return typeof a;default:return"string"}}}}}),angular.module("ubirchAdminCrudApp").directive("hcChart",["DeviceTypes","$filter",function(a,b){return{templateUrl:"views/directives/chart.html",restrict:"E",replace:!0,scope:{messages:"=",shownSeries:"=",separate:"="},link:function(c){function d(a,b){return void 0===m?!0:!angular.equals(a,b)}function e(){if(c.separate&&c.separate.yaxes)switch(c.separate.yaxes){case"all":n.yAxis=c.yaxes,n.series.forEach(function(a){i(a)});break;case"single":void 0!==n.yAxis&&(delete n.yAxis,n.series.forEach(function(a){j(a)}))}}function f(a,b,d,e){if(k(a,b,d,e),void 0===c.seriesColor[b]){c.seriesColor[b]=Highcharts.getOptions().colors[c.yaxes.length];var f={id:b,title:{text:b,style:{color:c.seriesColor[b]}},labels:{style:{color:c.seriesColor[b]}},opposite:!0};c.yaxes.push(f)}void 0===c.shownSeries[b]&&(c.shownSeries[b]=!0)}function g(){var d,e=a.getDeviceTypeList(),g={};return c.messages.forEach(function(a){var c=new Date(a.timestamp).getTime();(void 0===d||void 0!=d&&d.key!==a.deviceType)&&(d=b("getDeviceType")(e,a.deviceType)),Object.keys(a.deviceMessage).forEach(function(b){d&&d.displayKeys&&d.displayKeys.length>0?-1!==d.displayKeys.indexOf(b)&&f(g,b,a.deviceMessage[b],c):"number"==typeof a.deviceMessage[b]&&f(g,b,a.deviceMessage[b],c)})}),g}function h(a){var b=[],d=0;Object.keys(a).forEach(function(e){b[d]={},b[d].data=a[e],b[d].name=e,void 0!=c.shownSeries[e]&&(b[d].visible=c.shownSeries[e]),b[d].color=c.seriesColor[e],d++}),n.series=b}function i(a){a.yAxis=a.name}function j(a){void 0!==a.yAxis&&delete a.yAxis}function k(a,b,c,d){void 0===a[b]&&(a[b]=[]),a[b].unshift([d,c])}c.toggleYAxes=function(){if(c.separate&&c.separate.yaxes)switch(c.separate.yaxes){case"all":c.separate.yaxes="single";break;case"single":c.separate.yaxes="all"}};var l;Highcharts.setOptions({global:{useUTC:!1}}),Highcharts.dateFormats={O:function(a){var b=new Date(a),c=new Date(b.getFullYear(),b.getMonth(),b.getDate());if(void 0!==l&&l.getTime()===c.getTime())return"";var d=b.getDate()+"."+(b.getMonth()+1)+"."+b.getFullYear();return l=c,d}},c.seriesColor={},c.yaxes=[];var m,n={chart:{type:"line"},title:{text:"Sensor data"},credits:{enabled:!1},xAxis:{title:{text:"Date"},type:"datetime",startOnTick:!0,labels:{format:"{value:%O %H:%M:%S}",align:"right",rotation:-30}},plotOptions:{series:{events:{hide:function(){c.shownSeries[this.name]=!1},show:function(){c.shownSeries[this.name]=!0}}}}};c.$watch("messages",function(){if(d(m,c.messages)){var a=g();h(a),e(),new Highcharts.chart("hc_container",n),m=c.messages}}),c.$watch("separate.yaxes",function(a,b){void 0!=a&&b!==a&&(e(),new Highcharts.chart("hc_container",n))})}}}]),angular.module("ubirchAdminCrudApp").controller("LoginCtrl",["$scope","AuthService","buttonClassMappings",function(a,b,c){a.providersList=b.providerInfo.query(),a.getButtonClass=function(a){return c[a]&&c[a].buttonClass?c[a].buttonClass:c["default"].buttonClass},a.getButtonIcon=function(a){return c[a]&&c[a].iconClass?c[a].iconClass:c["default"].iconClass}}]);var app=angular.module("ubirchAuth",["ngStorage"]);app.factory("AccessToken",["$rootScope","$location","$sessionStorage","settings",function(a,b,c,d){function e(a){if(a&&(a.expires_in||d.DEFAULT_AUTH_EXPIRED_SECS>=0)){var b=new Date,c=a.expires_in?parseInt(a.expires_in)-60:d.DEFAULT_AUTH_EXPIRED_SECS;b.setSeconds(b.getSeconds()+c),a.expires_at=b}}var f={token:null},g=["providerId","code","state","provider","session_state","access_token","token_type","expires_in","scope","nonce","authuser","error","error_description"];return f.getTokenFromHashParams=function(a){for(var b,c={},d=/([^&=]+)=([^&]*)/g;b=d.exec(a);){var f=decodeURIComponent(b[1]),h=decodeURIComponent(b[2]);g.indexOf(f)>=0&&(c[f]=h)}return c.code||c.access_token||c.error?(e(c),c):null},f.setTokenFromHashParams=function(a){var b=this.getTokenFromHashParams(a);return this.token=b,null!==b&&(c.token=null,delete c.token),b},f.addTokenParam=function(a,b){return this.token||(this.token={}),this.token[a]=b,this.token},f.saveTokenInSession=function(a){c.token=a},f.getTokenFromSession=function(){return c.token?c.token:null},f.get=function(){return this.token},f.set=function(a){f.token=a},f.storeInSession=function(a,b){c.authServiceProps||(c.authServiceProps={}),c.authServiceProps[a]=b},f.getFromSession=function(a){return c.authServiceProps?c.authServiceProps[a]:void 0},f.expired=function(a){return a&&a.expires_at&&new Date(a.expires_at)<new Date},f.destroy=function(){c.token=null,c.providerId=null,delete c.token,delete c.providerId,f.token=null},f}]),app.service("AuthService",["$resource","constants","settings","$rootScope","$location","AccessToken","UserService",function(a,b,c,d,e,f,g){var h=c.UBIRCH_AUTH_SERVICE_API_HOST+b.AUTH_SERVICE_REST_ENDPOINT,i={providerInfo:a(h+"/providerInfo/list/"+c.CONTEXT+"/"+c.APP_ID),verifyAuth:a(h+"/verify/code"),logout:a(h+"/logout/:token",{token:"@token"}),authorizationUrl:"",signOutRedirectUrl:"",init:function(a){a.authorizationUrl&&(this.authorizationUrl=a.authorizationUrl),a.signOutRedirectUrl&&(this.signOutRedirectUrl=a.signOutRedirectUrl),a.providerId&&f.storeInSession("providerId",a.providerId)},setRegistrationFlag:function(a){g.setRegistrationFlag(a)},authorize:function(){this.authorizationUrl&&this.authorizationUrl.length>0&&window.location.replace(this.authorizationUrl)},authenticationRequired:function(){var a=f.getTokenFromSession(),b=null!=a&&!f.expired(a);return d.signedIn=b,!b},signOut:function(){var a=f.getTokenFromSession();if(a&&a.providerId){var b=this;this.logout.get({token:a.token},function(){j(),d.$broadcast("auth:signedOut","You have been logged out"),e.url(b.signOutRedirectUrl)},function(){k("LogoutFailedError","Something went wrong, you cannot be logged out")})}else k("LogoutFailedError","Something went wrong, you cannot be logged out")},verify:function(){var a=window.location.hash,b=a.length>0?a.indexOf("?"):-1;if(b>=0){var e=a.substr(a.indexOf("?")+1),h=f.setTokenFromHashParams(e);if(h)if(h.error)k(h.error,h.error_description);else{var j=h.providerId||f.getFromSession("providerId");f.addTokenParam("providerId",j),h.code&&h.state&&j&&this.verifyAuth.save({context:c.CONTEXT,appId:c.APP_ID,providerId:j,code:h.code,state:h.state},function(a){if(a.token){var b=f.addTokenParam("token",a.token);f.saveTokenInSession(b),g.getAccount().$promise.then(function(a){void 0!==a?g.isRegistrationFlagSet()?d.$broadcast("auth:alreadyRegisteredLogin",a):(d.signedIn=!0,d.$broadcast("auth:loggedIn",a)):k("accountNotAccessibleError","Something went wrong while accessing account")},function(b){switch(b.status){case 400:"NoUserInfoFound"===b.data.errorType&&(g.isRegistrationFlagSet()?i.register():d.$broadcast("auth:registrationRequired",a.token));break;case 403:d.$broadcast("auth:authRequired","You need to login");break;default:k("accountNotAccessibleError","Something went wrong while accessing account")}})}else k("InconsistentCodeStateError","Something went wrong with your authentication (code and/or state not the same as sended - probably a manInTheMiddle")},function(a){k(a.data.errorType,a.data.errorMessage)})}else d.$broadcast("auth:authError","Authentication token from OpenId Connect provider didn't contain code and/or state parameter.")}else{var l=f.getTokenFromSession();l?f.expired(l)?d.$broadcast("auth:authExpired","Your authentication token has expired. You need a new one. Please login again!"):(f.set(l),d.$broadcast("auth:verified","You are logged in successfully")):d.$broadcast("auth:authRequired","You need to login")}},register:function(){g.register.save(function(a){void 0!==a?(g.setAccount(a),d.signedIn=!0,d.$broadcast("auth:loggedIn")):k("accountNotAccessibleError","Something went wrong while accessing account")},function(a){k(a.errorId,a.errorMessage)})},abort:function(){j()}},j=function(){f.destroy(),g.destroy()},k=function(a,b){if("LogoutFailedError"===a)d.$broadcast("auth:verified",b);else switch(j(),a){case"authWarning":d.$broadcast("auth:authWarning",b);break;case"accountNotAccessibleError":d.$broadcast("auth:authError",a+": "+b);break;default:d.$broadcast("auth:authError",a+": "+b)}};return i}]),app.factory("OAuth2Interceptor",["$q","$sessionStorage","$location","AccessToken",function(a,b,c,d){var e={request:function(a){var c=b.token;return c&&!d.expired(c)?(a.headers.Authorization="Bearer "+c.token,a):a},responseError:function(b){switch(console.log("Failed with",b.status,"status"),b.status){case 401:case 403:b.config.url.includes("avatarService")&&(d.destroy(),c.url("/login"));break;case 405:}return a.reject(b)}};return e}]),app.directive("authButton",["AuthService",function(a){var b={templateUrl:"views/templates/social-media-button.html",restrict:"E",replace:!0,scope:{template:"@",buttonClass:"@",buttonIconClass:"@",signInText:"@",providerId:"@",authorizationUrl:"@",registration:"@"}};return b.link=function(b){function c(){b.buttonClass=b.buttonClass||"btn btn-primary",b.buttonIconClass=b.buttonIconClass||"glyphicon glyphicon-log-in",b.signInText=b.signInText||"Sign In",b.providerId=b.providerId||"",b.authorizationUrl=b.authorizationUrl||"",void 0!==b.registration&&b.registration?a.setRegistrationFlag(!0):a.setRegistrationFlag(!1)}b.$watch("authorizationUrl",function(){c()}),b.signIn=function(){a.init(b),a.authorize()}},b}]),app.directive("authNavButton",["$location","AuthService","$rootScope",function(a,b,c){return{restrict:"E",templateUrl:"views/templates/auth-nav-button.html",replace:!0,scope:{loginUrl:"@",registerUrl:"@",loginText:"@",registerText:"@",logoutText:"@",signOutRedirectUrl:"@"},link:function(d){d.loginText=d.loginText||"login",d.registerText=d.registerText||"register",d.logoutText=d.logoutText||"logout";var e={signOutRedirectUrl:d.signOutRedirectUrl||d.loginUrl};b.init(e),d.login=function(){a.url(d.loginUrl)},d.register=function(){a.url(d.registerUrl)},d.logout=function(){b.signOut()},void 0===c.signedIn&&(c.signedIn=!1),d.$on("auth:authError",function(){c.signedIn=!1}),d.$on("auth:authExpired",function(){c.signedIn=!1}),d.$on("auth:authRequired",function(){c.signedIn=!1}),d.$on("auth:signedOut",function(){c.signedIn=!1}),d.$on("auth:verified",function(){c.signedIn=!0})}}}]),angular.module("ubirchAdminCrudApp").constant("buttonClassMappings",{
github:{buttonClass:"btn btn-block btn-github",iconClass:"ion-social-github"},ebay:{logoUrl:"https://upload.wikimedia.org/wikipedia/commons/1/1b/EBay_logo.svg"},google:{buttonClass:"btn btn-block btn-google-plus",iconClass:"ion-social-google"},yahoo:{buttonClass:"btn btn-block btn-yahoo",iconClass:"ion-social-yahoo"},facebook:{buttonClass:"btn btn-block btn-facebook",iconClass:"ion-social-facebook"},instagram:{buttonClass:"btn btn-block btn-instagram",iconClass:"ion-social-instagram"},twitter:{buttonClass:"btn btn-block btn-twitter",iconClass:"ion-social-twitter"},windowslive:{buttonClass:"btn btn-block btn-live",iconClass:"ion-social-windows"},linkedin:{buttonClass:"btn btn-block btn-linkedin",iconClass:"ion-social-linkedin"},twitch:{buttonClass:"btn btn-block btn-twitch",iconClass:"ion-social-twitch"},paypal:{buttonClass:"btn btn-block btn-live",iconClass:"fa fa-paypal"},foursquare:{buttonClass:"btn btn-block btn-foursquare",iconClass:"fa fa-foursquare"},bitbucket:{buttonClass:"btn btn-block btn-bitbucket",iconClass:"fa fa-bitbucket"},"default":{buttonClass:"btn btn-block btn-social-default",iconClass:"ion-log-in"}}),angular.module("ubirchAdminCrudApp").controller("AuthCtrl",["$scope","$location","AuthService","$rootScope",function(a,b,c,d){a.workinprogress=!0,a.error=void 0,a.authExpired=void 0,a.success=void 0,a.$on("auth:authError",function(b,c){a.success=!1,a.workinprogress=!1,a.error=c}),a.$on("auth:alreadyRegisteredLogin",function(){a.workinprogress=!1,angular.element("#registeredModal").modal("show")}),a.$on("auth:authExpired",function(b,c){a.success=!1,a.workinprogress=!1,a.authExpired=!0,a.error=c}),a.$on("auth:authRequired",function(){a.success=!1,a.workinprogress=!1,b.url("/login")}),a.$on("auth:loggedIn",function(){a.success=!0,a.workinprogress=!1,b.url("/")}),a.$on("auth:registrationRequired",function(){a.workinprogress=!1,angular.element("#registrationModal").modal("show")}),a.$on("auth:signedOut",function(){a.success=!1,a.workinprogress=!1,b.url("/login")}),c.verify(),a.register=function(){d.closeModal("#registrationModal"),c.register()},a.noRegistration=function(){d.closeModal("#registrationModal"),c.abort(),a.workinprogress=!1,b.url("/login")},a.closeRegisteredModal=function(){d.closeModal("#registeredModal"),a.$broadcast("auth:loggedIn")},a.openLogin=function(){b.url("/login")},a.openRegister=function(){b.url("/register")}}]),angular.module("ubirchAdminCrudApp").directive("rangeFilter",["Device","constants","moment","$timeout",function(a,b,c,d){return{templateUrl:"views/directives/range-filter.html",restrict:"E",scope:{messages:"=",deviceId:"=",values:"=",activeTab:"="},link:function(e){function f(a){var b=c(e.values.startDate,"llll"),d=c(e.values.endDate,"llll");if(b.isAfter(d)){var f=b;b=d,d=f}var h=d.diff(b)*a;b.add(h),d.add(h),e.values.startDate=b.format("llll"),e.values.endDate=d.format("llll"),e.values.autoreload&&g()}function g(){"filterbydate"===e.activeTab.filter?void 0===e.values.startDate&&void 0===e.values.endDate?a.getHistoryOfRange(e.deviceId,e.values.startIndex,e.values.numOfMessages,function(a){if(a.length>0){e.messages=a;var b=c(e.messages[0].timestamp),d=c(e.messages[a.length-1].timestamp);b.isBefore(d)?(e.values.startDate=b.format("llll"),e.values.endDate=d.format("llll")):(e.values.startDate=d.format("llll"),e.values.endDate=b.format("llll")),e.todayReached=!0,e.endOfDataReached=!1}else e.messages=[]},function(){e.messages=[]}):a.getHistoryOfDateRange(e.deviceId,e.values.startDate,e.values.endDate,e.values.ignoreTime,function(a){a.length>0?e.messages=a:e.messages=[]},function(){e.messages=[]}):a.getHistoryOfRange(e.deviceId,e.values.startIndex,e.values.numOfMessages,function(a){a.length>0?(e.messages=a,e.endOfDataReached=!1):(e.messages=[],h())},function(){e.messages=[],h()})}function h(){e.values.startIndex=e.values.startIndex>=e.values.numOfMessages?e.values.startIndex-e.values.numOfMessages:0,e.endOfDataReached=!0}void 0===e.activeTab.filter&&(e.activeTab.filter="filterbydate"),e.todayReached=e.values.endDate>=b.TODAY,e.endOfDataReached=!1,e.numOfMessagesChanged=function(){g()},e.page_next=function(){e.values.startIndex=e.values.startIndex>=e.values.numOfMessages?e.values.startIndex-e.values.numOfMessages:0,g()},e.page_prev=function(){e.values.startIndex+=e.values.numOfMessages,g()};var i=1,j=-1;e.next_date=function(){f(i)},e.prev_date=function(){f(j)},e.$watch("deviceId",function(){e.deviceId&&g()});var k;e.$watch("messages",function(){void 0!==k&&d.cancel(k),k=d(g,b.POLLING_INTERVAL)}),e.$on("$destroy",function(){void 0!==k&&d.cancel(k)}),e.$on("auth:signedOut",function(){void 0!==k&&d.cancel(k)}),e.$watch("activeTab.filter",function(a,b){void 0!=b&&a!=b&&g()}),e.$watch("values.endDate",function(){e.todayReached=c(e.values.endDate,"llll").isSameOrAfter(c().subtract(1,"m"))}),e.switchToDateTime=function(){e.values.ignoreTime=!1},e.switchAutoreload=function(){e.values.autoreload=!e.values.autoreload},e.autoreload_history=function(){e.values.autoreload&&g()},e.load_history=function(){g()}}}}]),angular.module("ubirchAdminCrudApp").controller("RegisterCtrl",["$scope","AuthService","buttonClassMappings",function(a,b,c){a.providersList=b.providerInfo.query(),a.getButtonClass=function(a){return c[a]&&c[a].buttonClass?c[a].buttonClass:c["default"].buttonClass},a.getButtonIcon=function(a){return c[a]&&c[a].iconClass?c[a].iconClass:c["default"].iconClass}}]),angular.module("ubirchAdminCrudApp").controller("notActivatedCtrl",function(){}),angular.module("ubirchAdminCrudApp").service("UserService",["$resource","constants","settings","$sessionStorage","$q",function(a,b,c,d,e){var f=c.UBIRCH_AUTH_SERVICE_API_HOST+b.USER_SERVICE_REST_ENDPOINT,g={account:{value:void 0},register:a(f+"/register"),userInfo:a(f+"/userInfo"),initRegistration:function(){d.registration={inProcess:!1}},setRegistrationFlag:function(a){void 0===this.getRegistrationFlag()&&this.initRegistration(),d.registration.inProcess=a},getRegistrationFlag:function(){return d.registration},isRegistrationFlagSet:function(){return void 0!==d.registration&&d.registration.inProcess},removeRegistrationFlag:function(){void 0!==d.registration&&(d.registration=null,delete d.registration)},getAccount:function(){return void 0===this.account.value&&(this.account.value=this.userInfo.get(function(a){return a},function(){return void 0})),this.account.value},setAccount:function(a){this.account.value=a},initActivation:function(){d.activation={activated:!1}},setActivationFlag:function(a){void 0===this.getActivationFlag()&&this.initActivation(),d.activation.activated=a},getActivationFlag:function(){return d.activation},activationCheckRequired:function(){var a=this.getActivationFlag();return void 0===a},removeActivationFlag:function(){void 0!==d.activation&&(d.activation=null,delete d.activation)},destroy:function(){this.removeRegistrationFlag(),this.removeActivationFlag()}};return g}]),angular.module("ubirchAdminCrudApp").directive("listFilter",["$rootScope",function(a){return{templateUrl:"views/directives/list-filter.html",restrict:"E",scope:{search:"="},link:function(b){void 0===a.search&&(a.search={}),b.search=a.search}}}]),angular.module("ubirchAdminCrudApp").controller("CheckActivationCtrl",["$scope","$location","$log","UserService",function(a,b,c,d){a.workinprogress=!0,a.notactivated=void 0;var e=function(c){var e=c.activeUser===!0?!0:!1;d.setActivationFlag(e),e?(a.workinprogress=!1,a.notactivated=!1,b.url("/")):(a.workinprogress=!1,a.notactivated=!0)};d.getAccount().$promise.then(e,function(a){"NoUserInfoFound"===a.data.errorType&&c.warn("No userInfo found: "+a)})}]),angular.module("ubirchAdminCrudApp").directive("map",["DeviceTypes","$filter","leafletBoundsHelpers",function(a,b,c){return{templateUrl:"views/directives/map.html",restrict:"E",replace:!0,link:function(d){function e(a){var b=o.indexOf(a);if(-1===b&&(b=o.push(a)-1,b>=n)){if(b=p.indexOf("0"),-1===b)return m[0];o[b]=a,p[b]="1"}return m[b]}function f(a){var b=o.indexOf(a);b>-1&&(p[b]="0")}function g(a){if(Object.keys(d.markers).length>0){var b=Object.keys(a);if(b.length){var e=a[b[0]],f=[[e.lat,e.lng],[e.lat,e.lng]];b.forEach(function(b){e=a[b],e.lat<f[0][0]&&(f[0][0]=e.lat),e.lng<f[0][1]&&(f[0][1]=e.lng),e.lat>f[1][0]&&(f[1][0]=e.lat),e.lng>f[1][1]&&(f[1][1]=e.lng)}),d.bounds=c.createBoundsFromArray(f)}else d.bounds={};return!0}return!1}function h(a){f(a.deviceId),delete a.markerColor;var b=j(a.deviceId,"");Object.keys(d.markers).forEach(function(a){0===a.indexOf(b)&&delete d.markers[a]}),d.markersDefined=g(d.markers)}function i(a){var b=a.messages;b&&b.forEach(function(c,f){var g=c.deviceMessage,h=g.la?parseFloat(g.la):g.location.lat?parseFloat(g.location.lat):void 0,i=g.lo?parseFloat(g.lo):g.location.lon?parseFloat(g.location.lon):void 0;if(h&&i){void 0===a.markerColor&&(a.markerColor=e(a.deviceId));var k={focus:!1,draggable:!1,lat:h,lng:i,message:l(c),icon:{type:"awesomeMarker",prefix:"ion",icon:"ion-radio-waves",markerColor:a.markerColor},opacity:1-1/b.length*f};d.markers[j(a.deviceId,f)]=angular.copy(k)}}),d.markersDefined=g(d.markers)}function j(a,b){var c=t.indexOf(a);return-1===c&&(c=t.push(a),c=t.indexOf(a)),c+"_"+b}function k(a,b,c){return b.length>0&&(b+=", "),b+=c+": "+a.deviceMessage[c]}function l(c){var d=a.getDeviceTypeList(),e=b("getDeviceType")(d,c.deviceType),f=new Date(c.timestamp).getTime(),g="";Object.keys(c.deviceMessage).forEach(function(a){e&&e.displayKeys&&e.displayKeys.length>0?-1!==e.displayKeys.indexOf(a)&&(g=k(c,g,a)):"location.lat"!=a&&"location.lon"!=a&&(g=k(c,g,a))});var h=e.name.en;return h+="<br><strong>",h+=g,h+="</strong>",h+="<br>"+b("date")(f,"yyyy-MM-dd, H:mm:ss")}for(var m=["red","darkgreen","blue","orange","black","gray","purple","green","beige","darkblue","pink","cadetblue","lightgray","lightgreen","darkred","lightblue","darkpurple","lightred"],n=m.length,o=[],p=[],q=0;n>q;q++)p[q]="0";var r=parseFloat(50.91),s=parseFloat(13.75);d.center={lat:r,lng:s,zoom:5},d.markers={},d.$watch("lastAddedDevice",function(a){void 0!==a&&void 0!==a.messages&&a.messages.$promise.then(function(b){b.length>0&&i(a)})}),d.$watch("lastRemovedDevice",function(a){void 0!==a&&h(a)});var t=[]}}}]),angular.module("ubirchAdminCrudApp").factory("NACL",["constants","$window","uuid2","moment","settings","$resource",function(a,b,c,d,e,f){function g(a,b){var c=Number(a).toString(16);for(b="undefined"==typeof b||null===b?b=2:b;c.length<b;)c="0"+c;return c}function h(a){for(var b="",c=0;c<a.length;c++)b+=g(a[c]);return b}function i(a){for(var b="",c=0;c<a.length;c+=16){for(var d=0;16>d&&d<a.length;d++)b+="0x"+g(a[c+d])+",";b+="\n"}return b}if(!b.nacl)return void 0;var j=e.UBIRCH_KEY_SERVICE_API_HOST+a.KEY_SERVICE_REST_ENDPOINT,k={keysList:f(j+"/pubkey/current/hardwareId/:hardwareId",{hardwareId:"@hardwareId"}),getCurrentKeysOf:function(a,b,c){this.keysList.query({hardwareId:a},function(a){b&&b(a)},function(a){c&&c(a)})},keyservice:f(j+"/pubkey"),generateKeyPairAndStorePubKey:function(e,f,g){var h=b.nacl.sign.keyPair();if(void 0!==h){var i=d().utc().format(a.KEY_TIME_FORMAT),j=d().add(1,"y").utc().format(a.KEY_TIME_FORMAT),k={hwDeviceId:e,pubKey:nacl.util.encodeBase64(h.publicKey),pubKeyId:c.newuuid(),algorithm:"ed25519",created:i,validNotBefore:i,validNotAfter:j},l=JSON.stringify(k,Object.keys(k).sort());console.log(l);var m=nacl.sign.detached(nacl.util.decodeUTF8(l),h.secretKey),n={pubKeyInfo:k,signature:nacl.util.encodeBase64(m)};this.keyservice.save(n,function(a){f&&f(a)},function(a){g&&g(a)})}return h},formatHex:function(a){return h(a)},formatCCP:function(a){return i(a)}};return k}]),angular.module("ubirchAdminCrudApp").run(["$templateCache",function(a){a.put("views/auth.html",'<div class="container-fluid" ng-cloak> <div ng-show="workinprogress"> <div class="area-header" ng-hide="error"> {{ \'CHECK_AUTHENTICATION\' | translate }}... </div> <div class="area-header" ng-show="error"> {{ \'AUTHENTICATION_FAILED\' | translate }}! </div> <div style="height:200px" ng-show="workinprogress"> <span us-spinner style="position: relative; top: 50%; left: 50%"></span> </div> </div> <div ng-show="error"> <p> {{\'SORRY_AUTHENTICATION_FAILED\' | translate }} </p> <p> {{error}} </p> <div class="row"> <button type="button" class="btn btn-primary btn-lg btn-block" title="{{ \'LOGIN\' | translate }}" ng-click="openLogin()"> <span class="glyphicon glyphicon-log-in" aria-hidden="true"></span> {{ \'LOGIN\' | translate }} </button> </div> <div class="row"> <button type="button" class="btn btn-primary btn-lg btn-block" title="{{ \'REGISTER\' | translate }}" ng-click="openRegister()"> <span class="glyphicon glyphicon-log-in" aria-hidden="true"></span> {{ \'REGISTER\' | translate }} </button> </div> </div> <ng-include src="\'views/popups/alreadyregisteredpopup.html\'"></ng-include> <ng-include src="\'views/popups/registrationpopup.html\'"></ng-include> </div>'),a.put("views/check-activation.html",'<div class="container-fluid" ng-cloak> <div ng-show="workinprogress"> <div class="area-header"> {{ \'CHECK_AUTHENTICATION\' | translate }}... </div> <div style="height:200px"> <span us-spinner style="position: relative; top: 50%; left: 50%"></span> </div> </div> <div ng-show="notactivated"> <div class="area-header"> <div> <h1>{{ \'NOT_ACTIVATED_HEADER\' | translate }}</h1> <p>{{ \'NOT_ACTIVATED\' | translate }}</p> </div> </div> </div> </div>'),a.put("views/device-details-dev-info.html",'<div class="tab-content" ng-cloak> <div class="form-group"> <h2>Device</h2> <div class="form-group"> <span class="label label-default">{{ \'DEVICE_NAME\' | translate }}</span> <input type="text" class="form-control" ng-model="device.deviceName" ng-readonly="true"> </div> <div class="form-group"> <span class="label label-default">{{ \'DEVICE_ID\' | translate }}</span> <input type="text" class="form-control" ng-model="device.deviceId" ng-readonly="true"> </div> <div class="form-group"> <span class="label label-default">{{ \'HW_DEVICE_ID\' | translate }}</span> <input type="text" class="form-control" ng-model="device.hwDeviceId" ng-readonly="true"> </div> <div class="form-group"> <span class="label label-default">{{ \'HASHED_HW_DEVICE_ID\' | translate }}</span> <input type="text" class="form-control" ng-model="device.hashedHwDeviceId" ng-readonly="true"> </div> <h2>Streaming API</h2> <div ng-show="devInfo.mqtt.host === undefined"> <div class="alert alert-warning" role="alert">{{ \'INFO_NO_MQTT_SERVER\' | translate }}<span ng-show="devInfo.deviceId !== undefined">.. {{ \'WAITING_FOR_RESPONSE\' | translate }}</span></div> </div> <div ng-hide="devInfo.mqtt.host === undefined"> <div class="form-group row"> <div class="col-lg-6 col-xs-12 col-md-6 col-sm-6"> <span class="label label-default">{{ \'MQTT_CREDENTIALS_USERNAME\' | translate }}:</span> <input type="text" class="form-control" ng-model="devInfo.mqtt.credentials.username" ng-change="credentialsChanged()"> </div> <div class="col-lg-6 col-xs-12 col-md-6 col-sm-6"> <span class="label label-default">{{ \'MQTT_CREDENTIALS_PWD\' | translate }}:</span> <input type="text" class="form-control" ng-model="devInfo.mqtt.credentials.pwd" ng-change="credentialsChanged()"> </div> </div> <div class="form-group"> <span class="label label-default">{{ \'MQTT_SERVER_URL\' | translate }}:</span> <input type="text" class="form-control" ng-model="devInfo.mqtt.serverUrl" readonly> </div> <div class="form-group"> <span class="label label-default">{{ \'MQTT_SCRIPT_EXAMPLE\' | translate }}:</span> <textarea class="form-control" rows="10" cols="80" readonly>\n\nDEVICEID={{devInfo.query.example.deviceId}}\n#{{ \'MQTT_INSERT_CREDENTIALS\' | translate }}\nUSER={{devInfo.mqtt.credentials.username}}\nPWD={{devInfo.mqtt.credentials.pwd}}\n\n#mqtt access\n{{devInfo.mqtt.curl}}\n      </textarea> </div> <div class="form-group"> <span class="label label-default">{{ \'MQTT_TOPIC\' | translate }}:</span> <input type="text" class="form-control" ng-model="devInfo.mqtt.topic" readonly> </div> </div> <h2>Query API</h2> <p> <a href="{{devInfo.query.docuUrl}}" target="_blank">{{ \'QUERY_API_OPEN_DOCU\' | translate }}</a> </p> <div class="form-group"> <span class="label label-default">{{ \'SHELL_SCRIPT_EXAMPLE\' | translate }}:</span> <textarea class="form-control" rows="10" cols="80" readonly>\nDEVICEID={{devInfo.query.example.deviceId}}\nTOKEN={{devInfo.query.example.token}}\nHOST={{devInfo.query.example.host}}\n\n#last 10 datapoints\n{{devInfo.query.example.curl}}\n      </textarea> </div> </div> </div>'),a.put("views/device-details-history.html",'<div class="tab-content" ng-cloak> <div> <range-filter messages="messages.content" device-id="deviceid" values="filterValues" active-tab="activeTab"></range-filter> <div ng-if="!messages.content || messages.content.length <= 0" class="row"> <div class="col-lg-6 col-md-6 col-sm-8 col-xs-10 col-lg-offset-3 col-md-offset-3 col-sm-offset-2 col-xs-offset-1 center_message">{{ \'NO_HISTORY_DATA\' | translate }}</div> </div> <div ng-if="messages.content.length > 0"> <div class="area-tabs"> <ul class="nav nav-tabs"> <li ng-class="{active: activeTab.visual == \'chart\'}"> <a ng-click="activeTab.visual = \'chart\'">{{ \'TABLABEL_CHART\' | translate }}</a> </li> <li ng-class="{active: activeTab.visual == \'map\', disabled: !markersDefined}"> <a ng-click="activeTab.visual = \'map\'">{{markersDefined ? \'TABLABEL_MAP\' : \'NO_MAP_AVAILABLE\' | translate}}</a> </li> </ul> <div class="tab-content"> <!-- state --> <div ng-switch="activeTab.visual"> <div ng-switch-when="chart"> <hc-chart messages="messages.content" shown-series="shownSeries" separate="seperationParams"></hc-chart> </div> <div ng-switch-when="map"> <leaflet lf-center="leafletValues.center" bounds="leafletValues.bounds" markers="leafletValues.markers" height="480px" width="100%"></leaflet> </div> </div> </div> </div> <div class="form-group" ng-hide="activeTab.filter == \'filterbyrange\'"> {{ \'INFO_MESSAGELIST_NOT_VISIBLE\' | translate }} </div> <div class="form-group" ng-show="activeTab.filter == \'filterbyrange\'"> <div class="message-list"> <uib-accordion> <div uib-accordion-group class="panel-default" ng-if="messages.content.length > 0" ng-repeat="message in messages.content" is-open="status.open"> <uib-accordion-heading> <div class="row"> <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2"><timestamp date="{{message.timestamp}}"></timestamp></div> <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8"><messageheader message="{{message}}"></messageheader></div> <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2"> <!--                <blockchain message=\'{{message._source.deviceMessage}}\'></blockchain> --> <i class="pull-right glyphicon" ng-class="{\'glyphicon-chevron-down\': status.open, \'glyphicon-chevron-right\': !status.open}"></i> </div> </div> </uib-accordion-heading> <messagecontent message="{{message}}"></messagecontent> </div> </uib-accordion> </div> </div> </div> </div> </div>'),a.put("views/device-details-keys.html",'<div class="tab-content" ng-cloak> <div ng-show="checkKeyPairCreationAllowed()"> <p> <button type="submit" class="btn btn-default" ng-click="generateKeyPair()">{{ \'GENERATE_KEY_PAIR\' | translate }}</button> </p> </div> <!-- KeyList --> <div class="row" ng-show="publicKeys"> <table class="table table-hover wrapping-table"> <tbody> <tr> <th>{{ \'PUBKEY\' | translate }}</th> <th>{{ \'PUBKEYID\' | translate }}</th> <th>{{ \'ALGORITHM\' | translate }}</th> <th>{{ \'CREATED\' | translate }}</th> <th>{{ \'VALID_NOT_BEFORE\' | translate }}</th> <th>{{ \'VALID_NOT_AFTER\' | translate }}</th> <th>{{ \'SIGNATURE\' | translate }}</th> </tr> <tr ng-repeat="key in publicKeys"> <td class="wrap-content"> {{key.pubKeyInfo.pubKey}} </td> <td> {{key.pubKeyInfo.pubKeyId}} </td> <td> {{key.pubKeyInfo.algorithm}} </td> <td> <timestamp date="{{key.pubKeyInfo.created}}"></timestamp> </td> <td> <timestamp date="{{key.pubKeyInfo.validNotBefore}}"></timestamp> </td> <td> <timestamp date="{{key.pubKeyInfo.validNotAfter}}"></timestamp> </td> <td> <span> <i ng-if="key.signature === undefined" class="ion-sad red"></i> <i ng-if="key.signature !== undefined && key.signature.length > 0" class="ion-checkmark green"></i> </span> </td> </tr> </tbody> </table> </div> <div ng-show="keys"> <div> <h3>Public Key</h3> <p>(submitted to backend)</p> </div> <div> <span class="label label-default">{{ \'KEY_HEX\' | translate }}</span> <input type="text" class="form-control" ng-model="keys.hex.public" ng-readonly="true"> </div> <div> <span class="label label-default">{{ \'KEY_BASE64\' | translate }}</span> <input type="text" class="form-control" ng-model="keys.base64.public" ng-readonly="true"> </div> <div> <div> <h3>Signing Key</h3> <p>(insert into PXT)</p> </div> <div> <span class="label label-default">{{ \'KEY_HEX\' | translate }}</span> <input type="text" class="form-control" ng-model="keys.hex.secret" ng-readonly="true"> </div> </div> <div> <h3>C++</h3> <p>(insert into code)</p> <pre id="cpp" style="">\n* ==== ECC KEYS ================= */\nstatic unsigned char vrfyKey[crypto_sign_PUBLICKEYBYTES] = {\n{{keys.ccp.public}}\n};\nstatic unsigned char signKey[crypto_sign_SECRETKEYBYTES] = {\n{{keys.ccp.secret}}\n};\n      </pre> </div> </div> </div>'),a.put("views/device-details-settings.html",'<div class="tab-content" ng-cloak> <div class="row"> <button type="button" class="btn btn-primary btn-lg btn-block" title="{{ \'SAVE\' | translate }}" ng-click="updateDevice()"> <span class="glyphicon glyphicon-save" aria-hidden="true"></span> {{ \'SAVE\' | translate }} </button> </div> <div> <form name="deviceForm"> <div class="form-group"> <span class="label label-default">{{ \'DEVICE_ID\' | translate }}<sup ng-hide="device.created">*</sup></span> <input type="text" class="form-control" ng-model="device.deviceId" ng-readonly="true" required> </div> <device-editable-fields device="device" added-properties="added"></device-editable-fields> <div class="form-group"> <span class="label label-default">{{ \'DEVICE_CREATED\' | translate }}</span> <timestamp date="{{device.created}}"></timestamp> </div> <div class="form-group"> <span class="label label-default">{{ \'DEVICE_UPDATED\' | translate }}</span> <timestamp date="{{device.updated}}"></timestamp> </div> </form> </div> <div class="row"> <button type="button" class="btn btn-primary btn-lg btn-block" title="{{ \'SAVE\' | translate }}" ng-click="updateDevice()"> <span class="glyphicon glyphicon-save" aria-hidden="true"></span> {{ \'SAVE\' | translate }} </button> </div> </div>'),a.put("views/device-details-state.html",'<div class="tab-content" ng-cloak> <div class="form-group"> <div> <button type="submit" class="btn btn-default" ng-show="stateDataChanged" ng-click="saveDeviceStateChanges()">{{ \'SAVE_CHANGES\' | translate }} </button> <button type="submit" class="btn btn-default" ng-show="stateDataChanged" ng-click="discardDeviceStateChanges()">{{ \'CANCEL\' | translate }} </button> </div> <table class="table table-hover"> <thead> <tr> <th></th> <th ng-repeat="stateKat in stateKats">{{stateKat}}</th> </tr> </thead> <tbody> <tr ng-repeat="(id,state) in deviceState"> <th scope="row"><a href="#" editable-text="state.stateKey" onbeforesave="checkDeviceStateChanges($data)">{{state.stateKey}}</a></th> <td ng-repeat="stateKat in stateKats"> <a href="#" editable-text="state.{{stateKat}}" onbeforesave="checkDeviceStateChanges($data)">{{state[stateKat] || \'-\' }}</a></td> </tr> </tbody> </table> <div class="form-group"> <span class="label label-default">{{ \'DEVICE_SYNC_STATE\' | translate }}</span> <syncstate in-sync="{{inSync}}"></syncstate> <span ng-if="inSync === undefined">{{ \'UNKNOWN\' | translate }}</span> <span ng-if="inSync !== undefined && inSync">{{ \'DEVICE_IN_SYNC\' | translate }}</span> <span ng-if="inSync !== undefined && !inSync">{{ \'DEVICE_OUT_OF_SYNC\' | translate }}</span> </div> <div class="form-group"> <span class="label label-default">{{ \'DEVICE_LAST_UPDATED\' | translate }}</span> <timestamp date="{{deviceLastUpdated}}"></timestamp> </div> <div class="form-group"> <span class="label label-default">{{ \'AVATAR_LAST_UPDATED\' | translate }}</span> <timestamp date="{{avatarLastUpdated}}"></timestamp> </div> </div> </div>'),a.put("views/device-details.html",'<div class="container" ng-cloak> <toaster-container toaster-options="{\'close-button\': true}"></toaster-container> <!-- device details --> <div class="area-header row vertical-align"> <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4"> {{ \'DEVICE_OVERVIEW_HEADLINE\' | translate }} </div> <div class="col-lg-7 col-md-7 col-sm-6 col-xs-6 h4"> {{device.deviceName}}&nbsp; <i class="sensor-type-icon {{deviceType.icon}}"></i> <small>{{deviceType.name.en}}</small> </div> <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2"> <button type="submit" class="btn btn-default btn-danger btn-wrap" data-toggle="modal" data-target="#myModal" title="{{ \'DELETE_DEVICE\' | translate }}"> <span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span> {{ \'DELETE_DEVICE\' | translate }} </button> </div> </div> <div class="area-tabs"> <ul class="nav nav-tabs nav-justified"> <li ng-class="{active: activeTab.main == \'history\'}"> <a ng-click="activeTab.main = \'history\'">{{ \'TABLABEL_HISTORY\' | translate }}</a> </li> <li ng-class="{active: activeTab.main == \'state\'}"> <a ng-click="activeTab.main = \'state\'">{{ \'TABLABEL_SYNC_STATE\' | translate }}</a> </li> <li ng-class="{active: activeTab.main == \'settings\'}"> <a ng-click="activeTab.main = \'settings\'">{{ \'TABLABEL_SETTINGS\' | translate }}</a> </li> <li ng-class="{active: activeTab.main == \'devinfo\'}"> <a ng-click="activeTab.main = \'devinfo\'">{{ \'TABLABEL_DEVINFO\' | translate }}</a> </li> <li ng-class="{active: activeTab.main == \'keys\'}"> <a ng-click="activeTab.main = \'keys\'">{{ \'TABLABEL_KEYS\' | translate }}</a> </li> </ul> <div class="tab-content"> <!-- state --> <div ng-switch="activeTab.main"> <div ng-switch-when="state"> <ng-include src="\'views/device-details-state.html\'"></ng-include> </div> <div ng-switch-when="history"> <ng-include src="\'views/device-details-history.html\'"></ng-include> </div> <div ng-switch-when="settings"> <ng-include src="\'views/device-details-settings.html\'"></ng-include> </div> <div ng-switch-when="devinfo"> <ng-include src="\'views/device-details-dev-info.html\'"></ng-include> </div> <div ng-switch-when="keys"> <ng-include src="\'views/device-details-keys.html\'"></ng-include> </div> </div> </div> </div> <ng-include src="\'views/popups/deletedevicepopup.html\'"></ng-include> </div>'),a.put("views/devices-list.html",'<div class="container-fluid" ng-cloak> <toaster-container toaster-options="{\'close-button\': true}"></toaster-container> <!-- Filter for DeviceList --> <div class="area-header row"> <div class="col-lg-4 col-md-4 col-sm-5 col-xs-5"> {{ \'DEVICES_LIST_HEADLINE\' | translate }} </div> <div class="col-lg-8 col-md-8 col-sm-7 col-xs-7"> <list-filter search="search"></list-filter> </div> </div> <!-- DeviceList --> <div class="row"> <table class="table table-hover"> <tbody> <tr ng-repeat="device in devices | filter:search" ng-click="openDeviceDetails(device.deviceId)" title="show device details" ng-class="{\'out-of-sync\': !device.inSync}"> <td> <i ng-repeat="deviceType in deviceTypes | filter:match(device.deviceTypeKey)" class="sensor-type-icon {{deviceType.icon}}"></i> </td> <th scope="row"> {{device.deviceName}}<br> <small>{{device.deviceId}}</small> </th> <!--\n        <td>\n          <truthworth device="{{device}}"></truthworth>\n        </td>\n--> <td> <syncstate in-sync="{{device.inSync}}"></syncstate> </td> <td> <timestamp date="{{device.deviceLastUpdated}}"></timestamp> </td> </tr> </tbody> </table> </div> <div class="row"> <button type="button" class="btn btn-primary btn-lg btn-block" ng-click="openNewDeviceDialog()" title="{{ \'ADD_DEVICE\' | translate }}"> <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> {{ \'ADD_DEVICE\' | translate }} </button> </div> <ng-include src="\'views/popups/newdevicepopup.html\'"></ng-include> </div>'),a.put("views/devices-map.html",'<div class="container-fluid" ng-cloak> <toaster-container toaster-options="{\'close-button\': true}"></toaster-container> <!-- Map --> <div class="area-map"> <map devices="{{selectedDevices}}"></map> </div> <div> <!-- Filter for DeviceList --> <div class="area-header row"> <div class="col-lg-4 col-md-4 col-sm-5 col-xs-5"> {{ \'DEVICES_LIST_HEADLINE\' | translate }} </div> <div class="col-lg-8 col-md-8 col-sm-7 col-xs-7"> <list-filter search="search"></list-filter> </div> </div> <!-- DeviceList --> <div class="row"> <table class="table table-hover"> <tbody> <tr ng-repeat="device in devices | filter:search" ng-click="switchDeviceSelection(device)" title="{{isSelected(device.deviceId)?\'hide\':\'show\'}} position of device" ng-class="{\'device_selected\': isSelected(device.deviceId)}"> <td> <i ng-repeat="deviceType in deviceTypes | filter:match(device.deviceTypeKey)" class="sensor-type-icon {{deviceType.icon}}"></i> </td> <th scope="row"> {{device.deviceName}}<br> <small>{{device.deviceId}}</small> </th> <!--\n                  <td>\n                    <truthworth device="{{device}}"></truthworth>\n                  </td>\n          --> <td> <syncstate in-sync="{{device.inSync}}"></syncstate> </td> <td> <timestamp date="{{device.deviceLastUpdated}}"></timestamp> </td> </tr> </tbody> </table> </div> </div> </div>'),a.put("views/devicetypes/messageheaders/default.html","<span>{{deviceMessage}}</span>"),a.put("views/devicetypes/messageheaders/lightssensor.html","<span>r: {{deviceMessage.r}}, g: {{deviceMessage.g}}, b: {{deviceMessage.b}}</span>"),a.put("views/devicetypes/messages/default.html",'<div ng-repeat="key in messageKeys">{{key}}: {{deviceMessage[key]}}</div>'),a.put("views/devicetypes/messages/lightssensor.html",'<div ng-repeat="key in messageKeys">{{key}}: {{deviceMessage[key]}}</div>'),a.put("views/directives/chart.html",'<div> <div> <button ng-if="separate && separate.yaxes" ng-click="toggleYAxes()">{{separate.yaxes === "all" ? "CHART_SINGLE_YAXIS" : "CHART_MULTI_YAXIS" | translate }}</button> </div> <div id="hc_container"></div> </div>'),a.put("views/directives/deviceeditablefields.html",'<div> <div class="form-group"> <span class="label label-default">{{ \'HW_DEVICE_ID\' | translate }}<sup ng-hide="creationView !== \'true\'">*</sup></span> <input type="text" class="form-control" ng-model="device.hwDeviceId" ng-readonly="creationView !== \'true\'" required> </div> <div class="form-group" ng-hide="creationView === \'true\'"> <span class="label label-default">{{ \'HASHED_HW_DEVICE_ID\' | translate }}</span> <input type="text" class="form-control" ng-model="device.hashedHwDeviceId" ng-readonly="true"> </div> <div class="form-group"> <span class="label label-default">{{ \'DEVICE_NAME\' | translate }}</span> <input type="text" class="form-control" ng-model="device.deviceName"> </div> <div class="form-group"> <span class="label label-default">{{ \'DEVICE_TYPE\' | translate }}</span> <devicetypelist device-type-key="device.deviceTypeKey"></devicetypelist> </div> <!-- config params --> <div class="form-group"> <span class="label label-default">{{ \'DEVICE_CONFIG\' | translate }}</span> <button type="submit" class="btn btn-default btn-xs" title="{{ \'ADD\' | translate }}" ng-click="add(\'config\')"> <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> </button> <table class="table table-hover"> <thead> <tr> <th>Parameter</th> <th>Value</th> <th></th> </tr> </thead> <tbody> <tr ng-hide="addedProperties.config.length === 0" ng-repeat="(index, config) in addedProperties.config"> <th scope="row"><input type="text" class="form-control" ng-model="config.key"></th> <td> <input type="text" class="form-control" ng-model="config.value"></td>  <td> <button type="submit" class="btn btn-danger btn-xs" title="{{ \'DELETE\' | translate }}" ng-click="deleteField(\'config\', index, true)"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> </button> </td> </tr> <tr ng-repeat="(key,param) in device.deviceConfig"> <th scope="row">{{key}}</th> <td data-ng-switch on="getTypeFor(device.deviceConfig[key])"> <input data-ng-switch-when="string" type="text" class="form-control" ng-model="device.deviceConfig[key]"> <input data-ng-switch-when="number" type="number" class="form-control" ng-model="device.deviceConfig[key]"> <input data-ng-switch-when="boolean" type="checkbox" class="form-control" ng-model="device.deviceConfig[key]"> </td> <td> <button type="submit" class="btn btn-danger btn-xs" title="{{ \'DELETE\' | translate }}" ng-click="deleteField(\'config\', key, false)"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> </button> </td> </tr> </tbody> </table> </div> <!-- properties params --> <div class="form-group"> <span class="label label-default">{{ \'DEVICE_PROPERTIES\' | translate }}</span> <button type="submit" class="btn btn-default btn-xs" title="{{ \'ADD\' | translate }}" ng-click="add(\'property\')"> <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> </button> <table class="table table-hover"> <thead> <tr> <th>Parameter</th> <th>Value</th> <th></th> </tr> </thead> <tbody> <tr ng-hide="addedProperties.properties.length === 0" ng-repeat="(index, property) in addedProperties.properties"> <th scope="row"><input type="text" class="form-control" ng-model="property.key"></th> <td> <input type="text" class="form-control" ng-model="property.value"> </td> <td> <button type="submit" class="btn btn-danger btn-xs" title="{{ \'DELETE\' | translate }}" ng-click="deleteField(\'property\', index, true)"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> </button> </td> </tr> <tr ng-repeat="(key,param) in device.deviceProperties"> <th scope="row">{{key}}</th> <td data-ng-switch on="getTypeFor(device.deviceProperties[key])"> <input data-ng-switch-when="string" type="text" class="form-control" ng-model="device.deviceProperties[key]"> <input data-ng-switch-when="number" type="number" class="form-control" ng-model="device.deviceProperties[key]"> <input data-ng-switch-when="boolean" type="checkbox" class="form-control" ng-model="device.deviceProperties[key]"> </td> <td> <button type="submit" class="btn btn-danger btn-xs" title="{{ \'DELETE\' | translate }}" ng-click="deleteField(\'property\', key, false)"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> </button> </td> </tr> </tbody> </table> </div> <!-- tag params --> <div class="form-group"> <span class="label label-default">{{ \'DEVICE_tags\' | translate }}</span> <button type="submit" class="btn btn-default btn-xs" title="{{ \'ADD\' | translate }}" ng-click="add(\'tag\')"> <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> </button> <table class="table table-hover"> <tbody> <tr ng-hide="addedProperties.tags.length === 0" ng-repeat="(index, tag) in addedProperties.tags"> <td> <input type="text" class="form-control" ng-model="tag.value"></td> <td> <button type="submit" class="btn btn-danger btn-xs" title="{{ \'DELETE\' | translate }}" ng-click="deleteField(\'tag\', index, true)"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> </button> </td> </tr> <tr ng-repeat="(index, tag) in device.tags"> <td data-ng-switch on="getTypeFor(device.tags[index])"> <input data-ng-switch-when="string" type="text" class="form-control" ng-model="device.tags[index]"> <input data-ng-switch-when="number" type="number" class="form-control" ng-model="device.tags[index]"> <input data-ng-switch-when="boolean" type="checkbox" class="form-control" ng-model="device.tags[index]"> </td> <td> <button type="submit" class="btn btn-danger btn-xs" title="{{ \'DELETE\' | translate }}" ng-click="deleteField(\'tag\', index, false)"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> </button> </td> </tr> </tbody> </table> </div> <div class="form-group"> <span class="label label-default">{{ \'DEVICE_SUBSCRIPTIONS\' | translate }}</span> </div> </div>'),
a.put("views/directives/devicetypelist.html",'<div class="fromgroup-with-button"> <div class="dropdown"> <button class="btn btn-default btn-xs dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"> <i class="sensor-type-icon {{selectedDeviceType.icon}}"></i> {{selectedDeviceType.name.en}} <span class="caret"></span> </button> <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"> <li ng-repeat="type in deviceTypes"> <a href="" ng-click="selectType(type)"> <i class="sensor-type-icon {{type.icon}}"></i> {{type.name.en}} </a></li>  </ul> </div> </div>'),a.put("views/directives/list-filter.html",'<form> <div class="input-group"> <span class="input-group-btn"> <button type="button" class="btn btn-default" title="remove filter" ng-click="search.deviceName = undefined" ng-hide="search.deviceName == undefined"> <span class="glyphicon glyphicon-remove-sign"></span> </button> </span> <input id="nameInput" ng-model="search.deviceName" type="text" class="form-control" placeholder="filter list.."> <span class="input-group-btn"> <button class="btn btn-default" type="button"> <span class="glyphicon glyphicon-search"></span> </button> </span> </div> </form>'),a.put("views/directives/map.html",'<div> <div> <leaflet center="center" bounds="bounds" markers="markers" height="480px" width="100%"></leaflet> </div> </div>'),a.put("views/directives/messagecontent.html",'<div ng-switch="type"> <div ng-switch-when="lightsSensor"> <ng-include src="\'views/devicetypes/messages/lightssensor.html\'"></ng-include> </div> <div ng-switch-default> <ng-include src="\'views/devicetypes/messages/default.html\'"></ng-include> </div> </div>'),a.put("views/directives/messageheader.html",'<div ng-switch="type"> <div ng-switch-when="lightsSensor"> <ng-include src="\'views/devicetypes/messageheaders/lightssensor.html\'"></ng-include> </div> <div ng-switch-default> <ng-include src="\'views/devicetypes/messageheaders/default.html\'"></ng-include> </div> </div>'),a.put("views/directives/navigation.html",'<div class="navbar navbar-default navbar-inverse" role="navigation"> <div class="container"> <!-- Brand and toggle get grouped for better mobile display --> <div class="navbar-header"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" title="ubirch" href="//ubirch.com/"></a> </div> <!-- Collect the nav links, forms, and other content for toggling --> <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1"> <ul class="nav navbar-nav"> <li ng-class="navClass(\'devices-list\')" ng-if="$root.signedIn && account.activated === true"><a href="" ng-click="loadDeviceslist()" data-toggle="tab" role="tab">devices</a></li> <li ng-class="navClass(\'devices-map\')" ng-if="$root.signedIn && account.activated === true"><a href="" ng-click="loadDevicesMap()" data-toggle="tab" role="tab">map</a></li> <!--\n                <li ng-class="navClass(\'about\')"><a href="" ng-click="loadAbout()" role="tab" data-toggle="tab">about</a></li>\n        --> </ul> <auth-nav-button login-url="/login" register-url="/register" login-text="{{ \'LOGIN\' | translate }}" register-text="{{ \'REGISTER\' | translate }}"></auth-nav-button> </div> <span ng-if="account.value !== undefined" class="nav-username pull-right collapsed">{{account.value.displayName}}</span> </div> </div>'),a.put("views/directives/range-filter.html",'<div class="area-tabs filter-group" ng-cloak> <ul class="nav nav-tabs"> <li ng-class="{active: activeTab.filter == \'filterbydate\'}"> <a ng-click="activeTab.filter = \'filterbydate\'">{{ \'TABLABEL_FILTERBY_DATE\' | translate }}</a> </li> <li ng-class="{active: activeTab.filter == \'filterbyrange\'}"> <a ng-click="activeTab.filter = \'filterbyrange\'">{{ \'TABLABEL_FILTERBY_RANGE\' | translate }}</a> </li> </ul> <div class="tab-content"> <div ng-switch="activeTab.filter"> <!-- filter by date --> <div ng-switch-when="filterbydate"> <div class="row vertical-align"> <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1"> <span class="pull-left" ng-click="prev_date()"> <span class="glyphicon glyphicon-arrow-left" aria-hidden="true" title="{{ \'PAGE_PREV\' | translate }}"></span> </span> </div> <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4"> <div class="input-group"> <span class="input-group-addon" id="from_date">{{ \'FROM\' | translate }}</span> <input type="text" class="form-control input-sm" datetimepicker datetimepicker-options="{format:\'llll\', icons:{next:\'glyphicon glyphicon-arrow-right\',previous:\'glyphicon glyphicon-arrow-left\',up:\'glyphicon glyphicon-arrow-up\',down:\'glyphicon glyphicon-arrow-down\'}}" name="from_time" ng-model="values.startDate" ng-change="autoreload_history()" aria-describedby="from_date"> </div> </div> <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1"></div> <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4"> <div class="input-group"> <span class="input-group-addon" id="to_date">{{ \'to\' | translate }}</span> <input type="text" class="form-control input-sm" datetimepicker datetimepicker-options="{format:\'llll\', icons:{next:\'glyphicon glyphicon-arrow-right\',previous:\'glyphicon glyphicon-arrow-left\',up:\'glyphicon glyphicon-arrow-up\',down:\'glyphicon glyphicon-arrow-down\'}}" name="to_time" ng-model="values.endDate" ng-change="autoreload_history()" aria-describedby="from_date"> </div> </div> <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1"> <button class="btn btn-default" ng-class="values.autoreload ? \'auto_reload\' : \'no_auto_reload\'" type="button" title="{{ \'RELOAD\' | translate }}" ng-click="load_history()"> <span class="glyphicon glyphicon-repeat"></span></button> </div> <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1"> <span class="pull-right" ng-hide="todayReached" ng-click="next_date()"> <span class="glyphicon glyphicon-arrow-right" aria-hidden="true" title="{{ \'PAGE_NEXT\' | translate }}"></span> </span> </div> </div> <div class="row"> <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10"></div> <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2"> <a ng-click="switchAutoreload()">{{ values.autoreload ? \'DEACTIVATE_AUTO_RELOAD\' : \'ACTIVATE_AUTO_RELOAD\' | translate }}</a> </div> </div> </div> <!-- filter by dataset range --> <div ng-switch-when="filterbyrange"> <div class="row vertical-align"> <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1"> <span class="pull-left" ng-hide="endOfDataReached" ng-click="page_prev()"> <span class="glyphicon glyphicon-arrow-left" aria-hidden="true" title="{{ \'PAGE_PREV\' | translate }}"></span> </span> </div> <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2"></div> <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5"> <div class="input-group"> <span class="input-group-addon" id="num_of_dataset">{{ \'NUM_OF_DATASETS\' | translate }}:</span> <input type="number" class="form-control" ng-model="values.numOfMessages" aria-describedby="num_of_dataset"> </div> </div> <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3"> <button type="submit" class="btn btn-default" title="{{ \'RELOAD\' | translate }}" ng-click="numOfMessagesChanged()"> <span class="glyphicon glyphicon-repeat" aria-hidden="true"></span> </button> </div> <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1"> <span class="pull-right" ng-show="values.startIndex > 0" ng-click="page_next()"> <span class="glyphicon glyphicon-arrow-right" aria-hidden="true" title="{{ \'PAGE_NEXT\' | translate }}"></span> </span> </div> </div> </div> </div> </div> </div>'),a.put("views/directives/syncstate.html",'<span> <i ng-if="showInSync === undefined" class="ion-sad grey"></i> <i ng-if="showInSync !== undefined && showInSync" class="ion-happy-outline"></i> <i ng-if="showInSync !== undefined && !showInSync" class="ion-sad red"></i> </span>'),a.put("views/directives/timestamp.html",'<span> <span ng-if="date && isToday(date)"> {{date | date:\'HH:mm:ss\'}} </span> <span ng-if="date && !isToday(date)"> {{date | date:\'dd.MM.yy HH:mm:ss\'}} </span> <span ng-if="date === undefined"> undefined </span> </span>'),a.put("views/login.html",'<div class="container-fluid" ng-cloak> <div class="area-header"> <span>{{ \'LOGIN_PLEASE\' | translate }}</span> </div> <div style="height:200px" ng-show="!providersList.length"> <span us-spinner style="position: relative; top: 50%; left: 50%"></span> </div> <div class="row"> <div class="col-lg-6 col-lg-offset-3 col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2 col-xs-10 col-xs-offset-1"> <div ng-repeat="provider in providersList"> <auth-button authorization-url="{{provider.redirectUrl}}" sign-in-text="{{ \'SIGN_IN_WITH\' | translate }} {{provider.name}}" button-class="{{getButtonClass(provider.id)}}" button-icon-class="{{getButtonIcon(provider.id)}}" provider-id="{{provider.id}}"> </auth-button> </div> </div> </div> </div>'),a.put("views/not-activated.html","<div> <h1>You are not activated yet!</h1> <p>You have already registered yourself for the ubirch IOT service but you have to wait for been activated by our support team.</p> </div>"),a.put("views/popups/alreadyregisteredpopup.html",'<!-- Modal --> <div class="modal fade" id="registeredModal" tabindex="-1" role="dialog" aria-labelledby="registeredModalLabel"> <div class="modal-dialog" role="document"> <div class="modal-content"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button> <h2 class="modal-title" id="registeredModalLabel">{{ \'ALLREADY_REGISTERED\' | translate }}</h2> </div> <div class="modal-body"> <h4>{{ \'ALLREADY_REGISTERED_INFO\' | translate }}</h4> </div> <div class="modal-footer"> <button type="button" class="btn btn-primary" data-dismiss="modal" data-backdrop="false" ng-click="closeRegisteredModal()">{{ \'OK\' | translate }}</button> </div> </div> </div> </div>'),a.put("views/popups/deletedevicepopup.html",'<!-- Modal --> <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"> <div class="modal-dialog" role="document"> <div class="modal-content"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button> <h2 class="modal-title" id="myModalLabel">{{ \'DELETE_DEVICE\' | translate }}</h2> </div> <div class="modal-body"> <h4>{{ \'CONFIRM_DELETE\' | translate }}</h4> </div> <div class="modal-footer"> <button type="button" class="btn btn-default" data-dismiss="modal">{{ \'CANCEL\' | translate }}</button> <button type="button" class="btn btn-primary" ng-click="deleteDevice()">{{ \'DELETE\' | translate }}</button> </div> </div> </div> </div>'),a.put("views/popups/newdevicepopup.html",'<!-- Modal --> <div class="modal" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"> <div class="modal-dialog" role="document"> <div class="modal-content"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-label="Close" ng-click="cancelCreateDevice()"><span aria-hidden="true">&times;</span></button> <h2 class="modal-title" id="myModalLabel">{{ \'ADD_DEVICE\' | translate }}</h2> </div> <form name="devicePropsForm"> <div class="modal-body"> <h4>{{ \'ADD_HWDEVICEID_OPTIONAL\' | translate }}</h4> <device-editable-fields device="newDevice" added-properties="addedProperties" creation-view="true"></device-editable-fields> </div> <div class="modal-footer"> <button type="button" class="btn btn-default" data-dismiss="modal" ng-click="cancelCreateDevice()">{{ \'CANCEL\' | translate }}</button> <button type="button" class="btn btn-primary" ng-click="createDevice()" ng-disabled="!devicePropsForm.$valid">{{ \'CREATE\' | translate }}</button> </div> </form> </div> </div> </div>'),a.put("views/popups/registrationpopup.html",'<!-- Modal --> <div class="modal fade" id="registrationModal" tabindex="-1" role="dialog" aria-labelledby="registrationModalLabel"> <div class="modal-dialog" role="document"> <div class="modal-content"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button> <h2 class="modal-title" id="registrationModalLabel">{{ \'REGISTRATION_REQUIRED\' | translate }}</h2> </div> <div class="modal-body"> <h4>{{ \'CONFIRM_DREGISTRATION\' | translate }}</h4> </div> <div class="modal-footer"> <button type="button" class="btn btn-default" data-dismiss="modal" ng-click="noRegistration()">{{ \'CANCEL\' | translate }}</button> <button type="button" class="btn btn-primary" ng-click="register()">{{ \'REGISTER_NOW\' | translate }}</button> </div> </div> </div> </div>'),a.put("views/register.html",'<div class="container-fluid" ng-cloak> <div class="area-header"> <span>{{ \'REGISTER_PLEASE\' | translate }}</span> </div> <div style="height:200px" ng-show="!providersList.length"> <span us-spinner style="position: relative; top: 50%; left: 50%"></span> </div> <div class="row"> <div class="col-lg-6 col-lg-offset-3 col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2 col-xs-10 col-xs-offset-1"> <div ng-repeat="provider in providersList"> <auth-button authorization-url="{{provider.redirectUrl}}" sign-in-text="{{ \'REGISTER_THROUGH\' | translate }} {{provider.name}}" button-class="{{getButtonClass(provider.id)}}" button-icon-class="{{getButtonIcon(provider.id)}}" provider-id="{{provider.id}}" registration="true"> </auth-button> </div> </div> </div> </div>'),a.put("views/templates/auth-nav-button.html",'<ul class="nav navbar-nav pull-right ng-scope"> <li ng-if="registerUrl && !$root.signedIn"><a ng-click="register()">{{registerText}}</a></li> <li ng-if="loginUrl && !$root.signedIn"><a ng-click="login()">{{loginText}}</a></li> <li ng-if="$root.signedIn"><a ng-click="logout()">{{logoutText}}</a></li> </ul>'),a.put("views/templates/social-media-button.html",'<button class="{{buttonClass}}" ng-click="signIn()"> <i class="{{buttonIconClass}}"></i> {{signInText}} </button>')}]);